<main role="main" class="d-flex flex-column container mx-auto">
    <div class="row" style="row-gap: 24px;" [formGroup]="createInstantQuote">
        <div class="col-12 d-flex align-items-center justify-content-center form-heading" style="gap: 16px;">
            <button class="back-btn border-0" (click)="goBack()" [disabled]="currentStepIndex === 0"
                [class]="currentStepIndex === 0 ? 'deactivated' : ''"
                [class.d-none]="currentStepIndex === renderedSteps.length-4"><img loading="lazy"
                    src="assets/icons/arrow-right.svg" alt=""> Go
                Back</button>
            <div class="active-step" [class.isActiveStep]="currentStep?.status === 'active' || 'completed'">
                {{steps[currentStepIndex].title}}
            </div>
            <div class="step-separator">{{steps[currentStepIndex].label}} <img loading="lazy"
                    src="assets/icons/slice.svg" alt="">
                {{renderedSteps.length}}
            </div>
            <div class="disabled-step" [class.isNextStep]="instantQuoteForm(steps[currentStepIndex].key)?.invalid">
                <span *ngIf="currentStepIndex === renderedSteps.length-1">{{steps[currentStepIndex].title}}</span>
                <span *ngIf="currentStepIndex < renderedSteps.length-1">{{steps[currentStepIndex + 1].title}}</span>
            </div>
            <button class="next-btn border-0" (click)=" goToNext()"
                [class.d-none]="currentStepIndex === renderedSteps.length-1"
                [disabled]="instantQuoteForm(steps[currentStepIndex].key)?.invalid"
                [class]="instantQuoteForm(steps[currentStepIndex].key)?.valid ? '' : 'deactivated'">Go
                Next <img loading="lazy" [class.pulse]="steps[0].status === 'active'" src="assets/icons/arrow-right.svg"
                    alt=""></button>
        </div>
        <ng-container *ngTemplateOutlet="returnStepsTemplate()"> </ng-container>
        <ng-template #iqCalendar>
            <div class="col-12  mx-auto">
                <iq-quote-calendar [dateTime]="_selectedQuoteDate"
                    (selectedDateTime$)="getQuoteDate($event)"></iq-quote-calendar>
            </div>
        </ng-template>
        <ng-template #iqEstimates>
            <div class="col-12 col-lg-9 mx-auto">
                <div class="row">
                    <div class="col-8 col-lg-10">
                        <div class="estimate-price">
                            {{(price_calculator$ | async)?.min_price | currency:'KES' }}-{{(price_calculator$ |
                            async)?.max_price | currency:'KES' }}
                        </div>
                        <div class="estimate-price-info">Estimated price range may be inaccurate,<br>
                            Please complete the process to receive a final quote</div>
                    </div>
                    <div class="col-4 col-lg-2">
                        <div class="hours-container">
                            <span class="hours-header"> {{ 'HOURS_ESTIMATES.HOURS' | translate }} </span>
                            <div class="hours-grp" *ngIf="spaceSelected">
                                <div class="estimate-price-info fs-6">
                                    {{spaceSelected.minHours}}-{{spaceSelected.maxHours}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class=" accordion" id="accordionQuote">
                    <div class="row">
                        <iq-quote-service (selectedService$)="getService($event)"></iq-quote-service>
                        <iq-quote-space (selectedSpaceEmit$)="getSpace($event)"></iq-quote-space>
                        <iq-quote-material (selectedMaterialEmit$)="getMaterial($event)"></iq-quote-material>
                        <iq-quote-additonal-info
                            (additionalInfoEmit$)="getAdditionalInfo($event)"></iq-quote-additonal-info>
                    </div>
                </div>
            </div>
        </ng-template>
        <ng-template #iqClientDetails>
            <div class="col-12 col-lg-9 mx-auto">
                <iq-quote-client-details (clientData$)="getClientData($event)"></iq-quote-client-details>
            </div>
        </ng-template>
        <ng-template #iqQuoteSummary>
            <iq-quote-summary [instantQuote]="this.createInstantQuote.value"></iq-quote-summary>
        </ng-template>
    </div>
</main>